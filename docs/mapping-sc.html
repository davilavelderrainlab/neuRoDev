<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Mapping Single-cell data | neuRoDev</title>
<meta name="author" content="Erik Bot &amp; Asia Zonca">
<meta name="description" content="5.1 Quickstart These are the main functions to map a single-cell RNA-sequencing dataset on the corticogenesis resource. This implies that the data loaded are already cluster profiles (or...">
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="Chapter 5 Mapping Single-cell data | neuRoDev">
<meta property="og:type" content="book">
<meta property="og:description" content="5.1 Quickstart These are the main functions to map a single-cell RNA-sequencing dataset on the corticogenesis resource. This implies that the data loaded are already cluster profiles (or...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Mapping Single-cell data | neuRoDev">
<meta name="twitter:description" content="5.1 Quickstart These are the main functions to map a single-cell RNA-sequencing dataset on the corticogenesis resource. This implies that the data loaded are already cluster profiles (or...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.33/datatables.js"></script><link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="libs/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">neuRoDev</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Summary</a></li>
<li><a class="" href="network.html"><span class="header-section-number">2</span> Network exploration</a></li>
<li><a class="" href="analysis.html"><span class="header-section-number">3</span> Analysis Tools</a></li>
<li><a class="" href="mapping-bulk.html"><span class="header-section-number">4</span> Mapping Bulk data</a></li>
<li><a class="active" href="mapping-sc.html"><span class="header-section-number">5</span> Mapping Single-cell data</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/davilavelderrainlab/neuRoDev/blob/main/book/">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="mapping-sc" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Mapping Single-cell data<a class="anchor" aria-label="anchor" href="#mapping-sc"><i class="fas fa-link"></i></a>
</h1>
<div id="quickstart-2" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Quickstart<a class="anchor" aria-label="anchor" href="#quickstart-2"><i class="fas fa-link"></i></a>
</h2>
<p>These are the main functions to map a single-cell RNA-sequencing dataset on the corticogenesis resource. This implies that the data loaded are already cluster profiles (or pseudobulk). Below we report a detailed description and examples on how to compute cluster profiles and perform mapping and further related analyses.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#STEP 1: load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">neuRoDev</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-gregmisc/gtools">gtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#STEP 2: load data </span></span>
<span><span class="va">corticogenesis_sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/corticogenesis.sce.html">corticogenesis.sce</a></span><span class="op">(</span>directory <span class="op">=</span> <span class="st">'~/Downloads'</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">'my_data'</span><span class="op">)</span> <span class="co">#choose your data object</span></span>
<span></span>
<span><span class="co">#STEP 3: mapping</span></span>
<span><span class="va">mapped_sc_pseudo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/mapNetwork.html">mapNetwork</a></span><span class="op">(</span>net <span class="op">=</span> <span class="va">corticogenesis_sce</span>, </span>
<span>                               new_profiles <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#STEP 4: inspect mapping</span></span>
<span><span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">new_plot</span></span>
<span><span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Barplot</span></span>
<span><span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Best.Annotation</span></span></code></pre></div>
</div>
<div id="loading-necessary-libraries-and-data-3" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Loading necessary libraries and data<a class="anchor" aria-label="anchor" href="#loading-necessary-libraries-and-data-3"><i class="fas fa-link"></i></a>
</h2>
<div id="loading-the-right-libraries-3" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Loading the right libraries<a class="anchor" aria-label="anchor" href="#loading-the-right-libraries-3"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># functions package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">neuRoDev</span><span class="op">)</span></span>
<span><span class="co"># extra packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap">ComplexHeatmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-gregmisc/gtools">gtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org">Matrix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="loading-the-networks-necessary-objects-3" class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> Loading the networks necessary objects<a class="anchor" aria-label="anchor" href="#loading-the-networks-necessary-objects-3"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corticogenesis_sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/corticogenesis.sce.html">corticogenesis.sce</a></span><span class="op">(</span>directory <span class="op">=</span> <span class="st">'~/Downloads'</span><span class="op">)</span></span>
<span><span class="va">neurogenesis_sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/neurogenesis.sce.html">neurogenesis.sce</a></span><span class="op">(</span>directory <span class="op">=</span> <span class="st">'~/Downloads'</span><span class="op">)</span></span>
<span><span class="va">gliogenesis_sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/gliogenesis.sce.html">gliogenesis.sce</a></span><span class="op">(</span>directory <span class="op">=</span> <span class="st">'~/Downloads'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="mapping-a-single-cell-rnaseq-dataset" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Mapping a single cell RNAseq dataset<a class="anchor" aria-label="anchor" href="#mapping-a-single-cell-rnaseq-dataset"><i class="fas fa-link"></i></a>
</h2>
<div id="data-preprocessing" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> Data preprocessing<a class="anchor" aria-label="anchor" href="#data-preprocessing"><i class="fas fa-link"></i></a>
</h3>
<p>This example dataset from <a href="https://www.nature.com/articles/s41586-019-1654-9">Kanton et al. (2019)</a> can be downloaded here. For the scope of the analyses, we pre-processed the data, removing low quality cells. We also performed proportional random sampling to ease following this tutorial, to a total of 10.000 cells. This implies the reduction of total cell number while keeping cell groups proportions.
To reproduce the figures in the paper, we used the complete dataset, processed using the <code>ACTIONet</code> pipeline up to clustering (see: <a href="https://compbio.mit.edu/ACTIONet/tutorials/intro.html" class="uri">https://compbio.mit.edu/ACTIONet/tutorials/intro.html</a>. The data were processed by using the following functions with default parameters: <strong>normalize.ace</strong>, <strong>reduce.ace</strong>, <strong>runACTIONet</strong>, <strong>clusterCells</strong>).</p>
<div class="my-note">
<p><strong>Warning:</strong> quality control needs to be done specifically to your dataset. We assume that cells in the following steps have passed standard quality controls. You can refer to the <a href="https://satijalab.org/seurat/archive/v3.0/pbmc3k_tutorial.html">Seurat pipeline</a> or to the <a href="https://scanpy.readthedocs.io/en/stable/tutorials/basics/clustering.html">scanpy</a> one in Python.</p>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ext_count_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">'~/Downloads/sc_count_matrix.rds'</span><span class="op">)</span></span></code></pre></div>
<p>Here we report the detailed pipeline of the standard Seurat steps required to obtain clusters, which are needed for the following analyses. It is possible to customize some parameters for the pipeline, which have to be tuned to your specific dataset.</p>
<details><summary><strong>Show code</strong>
</summary><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The pre-processing steps are done following the standard Seurat pipeline:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat">Seurat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sc_seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/CreateSeuratObject.html">CreateSeuratObject</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">ext_count_matrix</span><span class="op">)</span></span>
<span><span class="va">sc_seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html">NormalizeData</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sc_seu</span><span class="op">)</span></span>
<span><span class="va">sc_seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sc_seu</span>, span <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">sc_seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sc_seu</span>, features <span class="op">=</span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/VariableFeatures.html">VariableFeatures</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">numPCs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">ext_count_matrix</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sc_seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sc_seu</span>, features <span class="op">=</span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/VariableFeatures.html">VariableFeatures</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span>, npcs <span class="op">=</span> <span class="va">numPCs</span>, approx <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">PCs_to_use</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">sc_seu</span><span class="op">$</span><span class="va">pca</span><span class="op">@</span><span class="va">stdev</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="va">PCs_to_use</span> <span class="op">&lt;-</span> <span class="va">PCs_to_use</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">PCs_to_use</span><span class="op">)</span></span>
<span><span class="va">PCs_to_use</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">PCs_to_use</span><span class="op">)</span></span>
<span><span class="va">PCs_to_use</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">PCs_to_use</span> <span class="op">&gt;=</span> <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">PCs_to_use</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">numPCs</span>, <span class="va">PCs_to_use</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sc_seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html">FindNeighbors</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sc_seu</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">PCs_to_use</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sc_seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html">FindClusters</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sc_seu</span>, resolution <span class="op">=</span> <span class="fl">1</span>, algorithm <span class="op">=</span> <span class="fl">4</span>, random.seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># if this gives an error, try setting algorithm to 1 or check ?FindClusters</span></span>
<span></span>
<span><span class="va">sc_seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span><span class="va">sc_seu</span>, dims <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">PCs_to_use</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p>We can then visualize the UMAP with the clusters:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">sc_seu</span>, </span>
<span>        reduction <span class="op">=</span> <span class="st">"umap"</span>, </span>
<span>        label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:ch4-fig1"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig1-1.png" alt="Single-cell dataset UMAP with clusters." width="672"><p class="caption">
Figure 5.1: Single-cell dataset UMAP with clusters.
</p>
</div>
<p>Since this dataset contains cells from different stages, we can also check the stages distribution and map this information on the single cells:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stage_annotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span>, <span class="st">'.'</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">stage_annotation</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/Cells.html">Cells</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sc_seu</span><span class="op">$</span><span class="va">stage</span> <span class="op">&lt;-</span> <span class="va">stage_annotation</span></span>
<span></span>
<span><span class="va">stages_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">viridis</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">stage_annotation</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">stages_palette</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">stage_annotation</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">sc_seu</span>, </span>
<span>  group.by <span class="op">=</span> <span class="st">"stage"</span>,</span>
<span>  reduction <span class="op">=</span> <span class="st">"umap"</span>,</span>
<span>  cols <span class="op">=</span> <span class="va">stages_palette</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:ch4-fig2"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig2-1.png" alt="Single-cell dataset UMAP colored by stage." width="672"><p class="caption">
Figure 5.2: Single-cell dataset UMAP colored by stage.
</p>
</div>
</div>
<div id="data-summary" class="section level3" number="5.3.2">
<h3>
<span class="header-section-number">5.3.2</span> Data summary<a class="anchor" aria-label="anchor" href="#data-summary"><i class="fas fa-link"></i></a>
</h3>
<p>The standard mapping procedure requires the definition of summary transcriptional profiles for each cluster, that can be obtained in two ways:</p>
<ol style="list-style-type: decimal">
<li>Pseudobulk profiles (obtained by summing all counts in a cluster together and then normalizing using Counts Per Million (CPM)).</li>
<li>Expression signatures (obtained by averaging the normalized counts of all cells in a cluster and then subtracting the mean expression across all cells).</li>
</ol>
<p>Depending on the type of question, the user can choose the most suitable summary profile. The key distinction lies in the type of information captured: <strong>signatures</strong> represent relative expression, describing how a given cluster differs from the others and thus highlighting <strong>differences</strong>. In contrast, <strong>pseudobulk profiles</strong> capture <strong>absolute</strong> expression levels and are therefore more suitable for biological interpretation without emphasizing relative changes. Signatures are not suited if used in a relatively homogeneous dataset, as they will greatly enhance subtle differences which may just depicts noise.
For the following example we will use pseudobulk profiles, which is the more straightforward approach.</p>
<p>Pseudobulk profiles can be computed using the <strong>get_pseudobulk</strong> function, which will save as a <code>SingleCellExperiment</code> object the pseudobulk counts in <code>counts</code> and the log-normalized counts per millions in <code>logcounts</code></p>
<p>We now define the pseudobulks of the clusters that we obtained following the Seurat pipeline:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sc_pseudo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/get_pseudobulk.html">get_pseudobulk</a></span><span class="op">(</span>exp_matrix <span class="op">=</span> <span class="va">sc_seu</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">$</span><span class="va">counts</span>,</span>
<span>                            membership_vector <span class="op">=</span> <span class="va">sc_seu</span><span class="op">$</span><span class="va">seurat_clusters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sc_pseudo</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'c'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sc_pseudo</span><span class="op">)</span><span class="op">)</span> <span class="co">#to have strings and not numbers</span></span></code></pre></div>
</div>
<div id="mapping-on-the-reference-network" class="section level3" number="5.3.3">
<h3>
<span class="header-section-number">5.3.3</span> Mapping on the reference network<a class="anchor" aria-label="anchor" href="#mapping-on-the-reference-network"><i class="fas fa-link"></i></a>
</h3>
<p>Now comes the actual mapping part, which can be easily performed using the <strong>mapNetwork</strong> function, that requires the following main inputs:</p>
<ul>
<li>
<code>net</code>: the reference network to use</li>
<li>
<code>new_profiles</code>: the transcriptional profiles to map (either pseudobulk or signatures)</li>
</ul>
<p>Other useful inputs can be checked in the function help (<strong>?mapNetwork</strong>).</p>
<p>Since in the original paper they mention the presence of glial cell types, inhibitory and excitatory neurons, it is reasonable to map on the corticogenesis network. If your experimental design already defines the presence of only glial cells or only excitatory neurons (with their respective precursors), then it is suggested to map only on the neurogenesis and gliogenesis steps.
Another approach is to first map on the on the more general corticogenesis network and then map again on the precise lineage-specific networks, also on a subset of cells.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapped_sc_pseudo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/mapNetwork.html">mapNetwork</a></span><span class="op">(</span>net <span class="op">=</span> <span class="va">corticogenesis_sce</span>, </span>
<span>                               new_profiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">logcounts</a></span><span class="op">(</span><span class="va">sc_pseudo</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can now visualize the network with the mapped clusters on top:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">new_plot</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:ch4-fig3"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig3-1.png" alt="Corticogenesis network with mapped clusters." width="672"><p class="caption">
Figure 5.3: Corticogenesis network with mapped clusters.
</p>
</div>
<p>Newly mapped clusters will locate close to the most similar reference clusters, so it is possible to observe the most similar subclasses for each mapped cluster.
By visualizing the mapped network, we can already appreciate how the clusters generally map into two different sections of the network, one close to radial glia and cycling radial glia, while the other close to immature neurons. To quantify similarity, we developed a score per subclass per cluster, using the 15 most similar reference clusters’ annotations (the number of reference clusters to use can be set by changing <code>n_nearest</code> in the <strong>mapNetwork</strong> function).
This score sums up to 1 and represents the weighted fraction of clusters in the neighborhood belonging to the different subclasses.
The score can be visualized with a barplot reporting on the y-axis the proportions (between 0-1) of the different subclasses, and on the x-axis the mapped clusters.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Barplot</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ch4-fig4"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig4-1.png" alt="Annotation scores across clusters." width="672"><p class="caption">
Figure 5.4: Annotation scores across clusters.
</p>
</div>
<p>To get a single label for each mapped cluster, we take the maximum of these scores. This depicts the most similar subclass among the closest neighbors.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Best.Annotation</span></span>
<span><span class="co">#&gt;      c1      c2      c3      c4      c5      c6      c7 </span></span>
<span><span class="co">#&gt;   "eIN"  "miEN"   "eIN"   "cRG"    "RG"  "miEN"   "cRG" </span></span>
<span><span class="co">#&gt;      c8      c9     c10     c11     c12     c13     c14 </span></span>
<span><span class="co">#&gt;  "miEN"   "eIN"    "RG"   "eIN"   "cRG"   "cRG"    "RG" </span></span>
<span><span class="co">#&gt;     c15     c16     c17     c18     c19     c20     c21 </span></span>
<span><span class="co">#&gt;    "RG" "imNIT" "imNIT"    "RG"    "RG"    "RG"   "cRG" </span></span>
<span><span class="co">#&gt;     c22     c23 </span></span>
<span><span class="co">#&gt;   "eIN"    "RG"</span></span></code></pre></div>
<p>The same quantification can be obtained for stages of maturation, either by specifying <code>color_attr = 'Stages'</code> in the <strong>mapNetwork</strong> function, or by running the <strong>annotateMapping</strong> function, which requires the following inputs:</p>
<ul>
<li>
<code>net</code>: the reference network to use.</li>
<li>
<code>new_cor</code>: the correlation between mapped points and reference clusters, can be found here <code>mapped_object$new_cor</code>.</li>
<li>
<code>color_attr</code>: the annotation label to use, in this case ‘Stages’.</li>
</ul>
<p>Our mapping strategy allows the mapping of any expression matrix, thus we added a quantification of the mapping confidence, described with two diverse measures:</p>
<ol style="list-style-type: lower-alpha">
<li><p><strong>confidence</strong> (<code>mapped_object$annotation$Mapping.Confidence</code>) for each mapped point, showing average of the 15 highest correlation values that mapped point has with the reference clusters.</p></li>
<li><p><strong>global confidence</strong> (<code>mapped_object$annotation$Global.Confidence</code>), describing the average confidence across all mapped point.</p></li>
</ol>
<p>The confidence values can be accessed in the following way:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># per cluster confidence</span></span>
<span><span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Mapping.Confidence</span></span>
<span><span class="co">#&gt;        c1        c2        c3        c4        c5        c6 </span></span>
<span><span class="co">#&gt; 0.7130546 0.7547882 0.6901726 0.8477842 0.7965150 0.7947670 </span></span>
<span><span class="co">#&gt;        c7        c8        c9       c10       c11       c12 </span></span>
<span><span class="co">#&gt; 0.6281157 0.7647813 0.7314415 0.7639241 0.7194806 0.6995298 </span></span>
<span><span class="co">#&gt;       c13       c14       c15       c16       c17       c18 </span></span>
<span><span class="co">#&gt; 0.6288900 0.7215679 0.8474292 0.7706888 0.7342306 0.8037366 </span></span>
<span><span class="co">#&gt;       c19       c20       c21       c22       c23 </span></span>
<span><span class="co">#&gt; 0.6317051 0.7253773 0.5659153 0.6400742 0.5006500</span></span>
<span></span>
<span><span class="co"># global confidence</span></span>
<span><span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Global.Confidence</span></span>
<span><span class="co">#&gt; [1] 0.7162878</span></span></code></pre></div>
<p>The confidence score not only tells how similar are the mapped points to neighboring clusters, but also can help identifying profiles of low quality or cell types not represented in the resource.</p>
<p>For example, cluster 23 has a slightly lower confidence score (~0.50) compared to the others, so it may be worth further checking the quality of the cells in that cluster (<strong>not done here</strong>), to assess whether this could be a low quality group of cells.</p>
<p>Sometimes clusters have a high confidence score, but neighbors with different annotations, making it hard to actually infer a single annotation. To help with this, it is possible to apply the confidence score to the inferred annotations defined above:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># checking the annotation confidence of the first five clusters </span></span>
<span><span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Annotations.Confidence</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; $c1</span></span>
<span><span class="co">#&gt;        eIN       miEN </span></span>
<span><span class="co">#&gt; 0.61520448 0.09785007 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $c2</span></span>
<span><span class="co">#&gt;      miEN     imNIT </span></span>
<span><span class="co">#&gt; 0.6538900 0.1008981 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $c3</span></span>
<span><span class="co">#&gt;        eIN      imNIT </span></span>
<span><span class="co">#&gt; 0.64261159 0.04756101 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $c4</span></span>
<span><span class="co">#&gt;       cRG        RG </span></span>
<span><span class="co">#&gt; 0.5631011 0.2846830 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $c5</span></span>
<span><span class="co">#&gt;         RG        cRG </span></span>
<span><span class="co">#&gt; 0.74243175 0.05408324</span></span></code></pre></div>
</div>
<div id="knwoledge-transfer" class="section level3" number="5.3.4">
<h3>
<span class="header-section-number">5.3.4</span> Knwoledge transfer<a class="anchor" aria-label="anchor" href="#knwoledge-transfer"><i class="fas fa-link"></i></a>
</h3>
<p>The annotations newly defined can now be transferred to the original dataset and visualized at the single cell level.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_annotation</span> <span class="op">&lt;-</span> <span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Best.Annotation</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'c'</span>, <span class="va">sc_seu</span><span class="op">$</span><span class="va">seurat_clusters</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">new_annotation</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/Cells.html">Cells</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sc_seu</span><span class="op">$</span><span class="va">annotation</span> <span class="op">&lt;-</span> <span class="va">new_annotation</span></span>
<span></span>
<span><span class="va">corticogenesis_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">corticogenesis_sce</span><span class="op">$</span><span class="va">SubClass_color</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">corticogenesis_palette</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">corticogenesis_sce</span><span class="op">$</span><span class="va">SubClass</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">sc_seu</span>, </span>
<span>  reduction <span class="op">=</span> <span class="st">"umap"</span>,</span>
<span>  label <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"clusters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">sc_seu</span>, </span>
<span>  group.by <span class="op">=</span> <span class="st">"annotation"</span>,</span>
<span>  reduction <span class="op">=</span> <span class="st">"umap"</span>,</span>
<span>  cols <span class="op">=</span> <span class="va">corticogenesis_palette</span>,</span>
<span>  label <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"annotation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ch4-fig5"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig5-1.png" alt="Single-cell dataset UMAP with clusters and annotations." width="50%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig5-2.png" alt="Single-cell dataset UMAP with clusters and annotations." width="50%"><p class="caption">
Figure 5.5: Single-cell dataset UMAP with clusters and annotations.
</p>
</div>
<p>By looking at the UMAP labelled by cluster together with the newly annotated UMAP, we can appreciate that the cells annotated as cRG close to all the cells annotated as RG are indeed those of the cluster 4, the cluster with similar annotation values for both cRG and RG.</p>
<p>To further validate the annotation, we can also visualize the preferentially expressed genes in the relevant subclasses. We report gene sets preferentially expressed in each reference subclass or subclass group here.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corticogenesis_pe_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"~/Downloads/corticogenesis_subclass_preferential_genes.rds"</span><span class="op">)</span></span>
<span><span class="va">neurogenesis_pe_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"~/Downloads/neurogenesis_subclass_preferential_genes.rds"</span><span class="op">)</span></span>
<span><span class="va">gliogenesis_pe_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"~/Downloads/gliogenesis_subclass_preferential_genes.rds"</span><span class="op">)</span></span></code></pre></div>
<p>We can compute for the annotations of interest the mean expression of preferential genes in the single-cell dataset.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sc_seu</span><span class="op">$</span><span class="va">eIN.Score</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">colMeans</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/AssayData.html">GetAssayData</a></span><span class="op">(</span><span class="va">sc_seu</span>, slot <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span><span class="op">[</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">eIN</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">eIN</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">sc_seu</span><span class="op">$</span><span class="va">cRG.Score</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">colMeans</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/AssayData.html">GetAssayData</a></span><span class="op">(</span><span class="va">sc_seu</span>, slot <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span><span class="op">[</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">cRG</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">cRG</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">sc_seu</span><span class="op">$</span><span class="va">RG.Score</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">colMeans</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/AssayData.html">GetAssayData</a></span><span class="op">(</span><span class="va">sc_seu</span>, slot <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span><span class="op">[</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">RG</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">RG</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">sc_seu</span><span class="op">$</span><span class="va">imNIT.Score</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">colMeans</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/AssayData.html">GetAssayData</a></span><span class="op">(</span><span class="va">sc_seu</span>, slot <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span><span class="op">[</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">imNIT</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">imNIT</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">sc_seu</span><span class="op">$</span><span class="va">miEN.Score</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">colMeans</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://satijalab.github.io/seurat-object/reference/AssayData.html">GetAssayData</a></span><span class="op">(</span><span class="va">sc_seu</span>, slot <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span><span class="op">[</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">miEN</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">corticogenesis_pe_genes</span><span class="op">$</span><span class="va">miEN</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html">FeaturePlot</a></span><span class="op">(</span><span class="va">sc_seu</span>, </span>
<span>            features <span class="op">=</span> <span class="st">"eIN.Score"</span>, </span>
<span>            reduction <span class="op">=</span> <span class="st">"umap"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"eIN"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html">FeaturePlot</a></span><span class="op">(</span><span class="va">sc_seu</span>, </span>
<span>            features <span class="op">=</span> <span class="st">"cRG.Score"</span>, </span>
<span>            reduction <span class="op">=</span> <span class="st">"umap"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"cRG"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html">FeaturePlot</a></span><span class="op">(</span><span class="va">sc_seu</span>, </span>
<span>            features <span class="op">=</span> <span class="st">"RG.Score"</span>, </span>
<span>            reduction <span class="op">=</span> <span class="st">"umap"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"RG"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html">FeaturePlot</a></span><span class="op">(</span><span class="va">sc_seu</span>, </span>
<span>            features <span class="op">=</span> <span class="st">"imNIT.Score"</span>, </span>
<span>            reduction <span class="op">=</span> <span class="st">"umap"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"imNIT"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html">FeaturePlot</a></span><span class="op">(</span><span class="va">sc_seu</span>, </span>
<span>            features <span class="op">=</span> <span class="st">"miEN.Score"</span>, </span>
<span>            reduction <span class="op">=</span> <span class="st">"umap"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"miEN"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span></span>
<span>  <span class="va">sc_seu</span>, </span>
<span>  reduction <span class="op">=</span> <span class="st">"umap"</span>,</span>
<span>  group.by <span class="op">=</span> <span class="st">"annotation"</span>,</span>
<span>  cols <span class="op">=</span> <span class="va">corticogenesis_palette</span>,</span>
<span>  label <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"annotation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ch4-fig6"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig6-1.png" alt="Preferential genes expression" width="50%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig6-2.png" alt="Preferential genes expression" width="50%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig6-3.png" alt="Preferential genes expression" width="50%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig6-4.png" alt="Preferential genes expression" width="50%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig6-5.png" alt="Preferential genes expression" width="50%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig6-6.png" alt="Preferential genes expression" width="50%"><p class="caption">
Figure 5.6: Preferential genes expression
</p>
</div>
<p>By the expression of preferentially expressed genes defined in our resource match the expectations, and that cluster 4 has high expression of cRG markers, confirming the annotations given by the mapping strategy.
To further characterize our clusters, we can leverage the list of our manually curated Gene Ontology Biological Processes for the corticogenesis and neurogenesis networks and assess their expression levels in the mapped clusters.
The list of manually curated Biological Processes can be downloaded from here.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corticogenesis_GO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">'~/Downloads/corticogenesis_GOBP_genesets.rds'</span><span class="op">)</span></span>
<span><span class="va">neurogenesis_GO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">'~/Downloads/neurogenesis_GOBP_genesets.rds'</span><span class="op">)</span></span></code></pre></div>
<p>The preferential expression values of Gene Ontology Biological Processes (BP), Molecular Functions (MF), and Cellular Components (CC) for the three reference networks is also provided in the resource, and is available here.</p>
<p>Each object is a list containing preferential expression scores in one of the three reference networks in the three ontologies (BP, MF, CC). Each element of each list contains the activity (<code>activity</code>) derived from Gene Set Variation Analysis (one value per gene set in each cluster) and the preferential expression scores (<code>preferential</code>; one value per gene set in each subclass).</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corticogenesis_preferential_GO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">'~/Downloads/corticogenesis_preferential_GO.rds'</span><span class="op">)</span></span>
<span><span class="va">neurogenesis_preferential_GO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">'~/Downloads/neurogenesis_preferential_GO.rds'</span><span class="op">)</span></span>
<span><span class="va">gliogenesis_preferential_GO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">'~/Downloads/gliogenesis_preferential_GO.rds'</span><span class="op">)</span></span></code></pre></div>
<p>First, we compute the average expression of those gene sets:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sc_seu_cortico_GOBP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">corticogenesis_GO</span>, <span class="kw">function</span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">g</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">logcounts</a></span><span class="op">(</span><span class="va">sc_pseudo</span><span class="op">)</span><span class="op">[</span><span class="va">g</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu_cortico_GOBP</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" \\(GO:[0-9]+\\)$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu_cortico_GOBP</span><span class="op">)</span><span class="op">)</span> <span class="co">#to simplify the gene sets names</span></span>
<span></span>
<span><span class="va">sc_seu_cortico_GOBP</span> <span class="op">&lt;-</span> <span class="va">sc_seu_cortico_GOBP</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/pkg/gtools/man/mixedsort.html">mixedorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sc_seu_cortico_GOBP</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="co">#to put them in alphabetical order</span></span></code></pre></div>
<p>Then, we can visualize the relative expression in a Heatmap to assess which biological processes characterize more our mapped clusters.</p>
<details><summary><strong>Show the code (simplifying labels)</strong>
</summary><div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#this annotation replicates the one in Figure .. and aggregates cell types in major groups</span></span>
<span><span class="va">cortico_subclass_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">corticogenesis_preferential_GO</span><span class="op">$</span><span class="va">GO_Biological_Process_2025</span><span class="op">$</span><span class="va">preferential</span><span class="op">)</span></span>
<span><span class="va">cortico_subclass_groups</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cortico_subclass_groups</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'L23IT'</span>, <span class="st">'L35IT'</span>, <span class="st">'L6IT'</span>, <span class="st">'L6NIT'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'matEN'</span></span>
<span><span class="va">cortico_subclass_groups</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cortico_subclass_groups</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'LAMP5'</span>, <span class="st">'SST'</span>, <span class="st">'PVALB'</span>, <span class="st">'VIP'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'matIN'</span></span>
<span><span class="va">cortico_subclass_groups</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cortico_subclass_groups</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'imIT'</span>, <span class="st">'imNIT'</span>, <span class="st">'eEN'</span>, <span class="st">'miEN'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'immEN'</span></span>
<span><span class="va">cortico_subclass_groups</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cortico_subclass_groups</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'eIN'</span>, <span class="st">'imIN'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'immIN'</span></span>
<span><span class="va">cortico_subclass_groups</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cortico_subclass_groups</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Opc'</span>, <span class="st">'Oligo'</span>, <span class="st">'Astro'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'maGlia'</span></span>
<span><span class="va">cortico_subclass_groups</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cortico_subclass_groups</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Micro'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'miGlia'</span></span>
<span><span class="va">cortico_subclass_groups</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">cortico_subclass_groups</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'RG'</span>, <span class="st">'cRG'</span>, <span class="st">'IPC'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Prog'</span></span>
<span></span>
<span><span class="va">cortico_subclass_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cortico_subclass_groups</span>, </span>
<span>                                  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Prog'</span>, <span class="st">'immEN'</span>, <span class="st">'immIN'</span>, <span class="st">'matEN'</span>, <span class="st">'matIN'</span>, <span class="st">'maGlia'</span>, <span class="st">'miGlia'</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">cortico_gobp_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'Astro'</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'Oligo'</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'Opc'</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'OligoGlia'</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'matEN'</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'matIN'</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'immEN'</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'Micro'</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'Prog'</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">'Stress'</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Prog'</span>, <span class="st">'immEN'</span>, <span class="st">'matEN'</span>, <span class="st">'matIN'</span>, <span class="st">'Opc'</span>, <span class="st">'Oligo'</span>, <span class="st">'OligoGlia'</span>, <span class="st">'Astro'</span>, <span class="st">'Micro'</span>, <span class="st">'Stress'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cortico_gobp_pe</span> <span class="op">&lt;-</span> <span class="va">corticogenesis_preferential_GO</span><span class="op">$</span><span class="va">GO_Biological_Process_2025</span><span class="op">$</span><span class="va">preferential</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">corticogenesis_GO</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cortico_gobp_pe</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" \\(GO:[0-9]+\\)$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cortico_gobp_pe</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><details><summary><strong>Show the code (plotting heatmap)</strong>
</summary><div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ht1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span></span>
<span>  <span class="va">cortico_gobp_pe</span>,</span>
<span>  name <span class="op">=</span> <span class="st">'preferential\nexpression'</span>,</span>
<span>  width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">cortico_gobp_pe</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4.2</span>, <span class="st">'mm'</span><span class="op">)</span>, <span class="co">#4.2, 18,8</span></span>
<span>  height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cortico_gobp_pe</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4.2</span>, <span class="st">'mm'</span><span class="op">)</span>,</span>
<span>  show_row_dend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  show_column_dend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  row_title_rot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  row_names_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>  column_title_rot <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  column_split <span class="op">=</span> <span class="va">cortico_subclass_groups</span>,</span>
<span>  cluster_column_slices <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  row_split <span class="op">=</span> <span class="va">cortico_gobp_groups</span>,</span>
<span>  cluster_row_slices <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  column_title_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ht2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">sc_seu_cortico_GOBP</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">'scaled\nexpression'</span>,</span>
<span>  width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sc_seu_cortico_GOBP</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4.2</span>, <span class="st">'mm'</span><span class="op">)</span>,</span>
<span>  cluster_columns <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  row_names_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>  right_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">rowAnnotation</a></span><span class="op">(</span>max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_barplot.html">anno_barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sc_seu_cortico_GOBP</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span>, </span>
<span>                                                      gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                                   annotation_name_side <span class="op">=</span> <span class="st">'top'</span>, </span>
<span>                                   annotation_name_rot <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>  bottom_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation</a></span><span class="op">(</span>annotation <span class="op">=</span> <span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Best.Annotation</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sc_seu_cortico_GOBP</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                      col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>annotation <span class="op">=</span> <span class="va">corticogenesis_palette</span><span class="op">)</span>, </span>
<span>                      show_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      show_annotation_name <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>  show_column_dend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ht_list</span> <span class="op">&lt;-</span> <span class="va">ht1</span> <span class="op">+</span> <span class="va">ht2</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">ht_list</span>, heatmap_legend_side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ch4-fig7"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig7-1.png" alt="Heatmap of corticogenesis-specific GO biological processes in resource and mapped clusters." width="99%"><p class="caption">
Figure 5.7: Heatmap of corticogenesis-specific GO biological processes in resource and mapped clusters.
</p>
</div>
<p>This heatmap shows that generally the biological processes match the annotations, with radial glia clusters displaying higher expression of processes associated with proliferation and glial metabolism, but we can also see that clusters 19 and 23 show high expression of stress-related processes, while displaying low expression of the terms more related to radial glia, their assigned annotation. This could explain why cluster 23 has such a low mapping confidence and suggest that these clusters are composed by early stressed cells.</p>
The same type of analysis can be done with the neurogenesis network:
<details><summary><strong>Show the code (neurogenesis GO code)</strong>
</summary><div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sc_seu_neuro_GOBP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">neurogenesis_GO</span>, <span class="kw">function</span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">g</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">logcounts</a></span><span class="op">(</span><span class="va">sc_pseudo</span><span class="op">)</span><span class="op">[</span><span class="va">g</span>,<span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu_neuro_GOBP</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" \\(GO:[0-9]+\\)$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sc_seu_neuro_GOBP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sc_seu_neuro_GOBP</span> <span class="op">&lt;-</span> <span class="va">sc_seu_neuro_GOBP</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/pkg/gtools/man/mixedsort.html">mixedorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sc_seu_neuro_GOBP</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">neuro_gobp_pe</span> <span class="op">&lt;-</span> <span class="va">neurogenesis_preferential_GO</span><span class="op">$</span><span class="va">GO_Biological_Process_2025</span><span class="op">$</span><span class="va">activity</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">neurogenesis_GO</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">neuroTrends</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">neuro_gobp_pe</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/smooth.spline.html">smooth.spline</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">neuro_gobp_pe</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span>, </span>
<span>                <span class="va">neuro_gobp_pe</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>, spar <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">neuroTrends</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">neuro_gobp_pe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">neuroTrends</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">neuroTrends</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">neurogenesis_GO</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">neuroTrends</span> <span class="op">&lt;-</span> <span class="va">neuroTrends</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">neuroTrends</span>, <span class="fl">1</span>, <span class="va">which.max</span><span class="op">)</span>, <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html">rowMeans</a></span><span class="op">(</span><span class="va">neuroTrends</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">neuroTrends</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">" \\(GO:[0-9]+\\)$"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">neuroTrends</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stage_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">neurogenesis_sce</span><span class="op">$</span><span class="va">Stages_color</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">stage_palette</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">neurogenesis_sce</span><span class="op">$</span><span class="va">Stages</span><span class="op">)</span></span>
<span></span>
<span><span class="va">h1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">neuroTrends</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>              cluster_columns <span class="op">=</span> <span class="cn">F</span>, </span>
<span>              cluster_rows <span class="op">=</span> <span class="cn">F</span>,</span>
<span>              bottom_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation</a></span><span class="op">(</span>df<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>stage<span class="op">=</span><span class="va">neurogenesis_sce</span><span class="op">$</span><span class="va">Stages</span><span class="op">)</span>, </span>
<span>                                                    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>stage<span class="op">=</span><span class="va">stage_palette</span><span class="op">)</span>, </span>
<span>                                                    show_legend <span class="op">=</span> <span class="cn">F</span>, </span>
<span>                                                    show_annotation_name <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>, </span>
<span>              name <span class="op">=</span> <span class="st">'inferred expression\n(z scaled)'</span>, </span>
<span>              height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">'mm'</span><span class="op">)</span>, </span>
<span>              width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">30</span>, <span class="st">'mm'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ht2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">sc_seu_neuro_GOBP</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">neuroTrends</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">'scaled\nexpression'</span>,</span>
<span>  width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sc_seu_neuro_GOBP</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4.2</span>, <span class="st">'mm'</span><span class="op">)</span>,</span>
<span>  cluster_columns <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  row_names_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">9</span>,</span>
<span>                      fontface <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">sc_seu_neuro_GOBP</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">neuroTrends</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"c23"</span><span class="op">)</span>, <span class="st">"bold"</span>, <span class="st">"plain"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  right_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">rowAnnotation</a></span><span class="op">(</span>max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_barplot.html">anno_barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sc_seu_neuro_GOBP</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">neuroTrends</span><span class="op">)</span>,<span class="op">]</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span>, </span>
<span>                                                      gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                   annotation_name_side <span class="op">=</span> <span class="st">'top'</span>,</span>
<span>                                   annotation_name_rot <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, </span>
<span>  bottom_annotation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation</a></span><span class="op">(</span>annotation <span class="op">=</span> <span class="va">mapped_sc_pseudo</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">Best.Annotation</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sc_seu_cortico_GOBP</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                                        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>annotation <span class="op">=</span> <span class="va">corticogenesis_palette</span><span class="op">)</span>, </span>
<span>                                        show_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                        show_annotation_name <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, </span>
<span>  show_column_dend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">ht_list</span> <span class="op">&lt;-</span> <span class="va">h1</span> <span class="op">+</span> <span class="va">ht2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span><span class="va">ht_list</span>, heatmap_legend_side <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ch4-fig8"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig8-1.png" alt="Heatmap of neurogenesis-specific GO biological processes in resource and mapped clusters." width="85%"><p class="caption">
Figure 5.8: Heatmap of neurogenesis-specific GO biological processes in resource and mapped clusters.
</p>
</div>
<p>Again, the cluster with the highest neuroinflammatory response (indicative of stress) is cluster 23.
Thanks to the use of the neurogenesis-specific network we can appreciate how neuronal specific processes are expressed in clusters assigned to the immature neuron annotations and not in those labelled as progenitors.</p>
<p>Additionally, we can visualize the mapped points directly on the eTraces, to see how similar they are to clusters in the resource network based on gene expression.
The function to perform such analysis is <strong>map_eTrace</strong>, which requires the following inputs:</p>
<ul>
<li>
<code>net</code>: the reference network to use</li>
<li>
<code>mapped_obj</code>: the result of <strong>mapNetwork</strong>
</li>
<li>the inputs required to run <strong>plot_eTrace</strong> (see the <a href="analysis.html#analysis">Chapter Analysis tools</a>)</li>
</ul>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/map_eTrace.html">map_eTrace</a></span><span class="op">(</span>net <span class="op">=</span> <span class="va">corticogenesis_sce</span>, </span>
<span>         mapped_obj <span class="op">=</span> <span class="va">mapped_sc_pseudo</span>, </span>
<span>         genes <span class="op">=</span> <span class="st">'VIM'</span>,</span>
<span>         main <span class="op">=</span> <span class="st">"VIM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/map_eTrace.html">map_eTrace</a></span><span class="op">(</span>net <span class="op">=</span> <span class="va">corticogenesis_sce</span>, </span>
<span>         mapped_obj <span class="op">=</span> <span class="va">mapped_sc_pseudo</span>, </span>
<span>         genes <span class="op">=</span> <span class="st">'SYT1'</span>,</span>
<span>         main <span class="op">=</span> <span class="st">"SYT1"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ch4-fig9"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig9-1.png" alt="VIM and SYT1 eTrace in corticogenesis and mapped points" width="50%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig9-2.png" alt="VIM and SYT1 eTrace in corticogenesis and mapped points" width="50%"><p class="caption">
Figure 5.9: VIM and SYT1 eTrace in corticogenesis and mapped points
</p>
</div>
<p>From this type on analysis we can clearly appreciate the distinction between radial glia-like clusters and more neuronal ones. Additionally, we can see at a glance which mapped points resemble more mature reference clusters, as age increases from left to right. The more rightward clusters are: 2, 9, 11, and 14.
If we check the percentage of cells belonging to the latest time point (4 months) across each cluster,
we can see that those clusters are also those with the highest proportion of latest-stage cells:</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">sc_seu</span><span class="op">$</span><span class="va">stage</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'c'</span>, <span class="va">sc_seu</span><span class="op">$</span><span class="va">seurat_clusters</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">i</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">[</span><span class="st">'Organoid-4M'</span>,<span class="op">]</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt;        c12        c13        c17        c20        c21 </span></span>
<span><span class="co">#&gt;  0.0000000  0.0000000  0.0000000  0.0000000  0.0000000 </span></span>
<span><span class="co">#&gt;        c22         c7        c16        c18        c10 </span></span>
<span><span class="co">#&gt;  0.0000000  0.0000000  0.2590674  0.2857143  0.8968610 </span></span>
<span><span class="co">#&gt;         c8         c3         c6         c5        c15 </span></span>
<span><span class="co">#&gt;  1.2219959  1.3736264  3.2374101  4.3478261  8.7281796 </span></span>
<span><span class="co">#&gt;        c19         c4         c1        c23         c2 </span></span>
<span><span class="co">#&gt;  9.7826087 10.3395062 11.1006585 11.7647059 42.8571429 </span></span>
<span><span class="co">#&gt;        c14        c11         c9 </span></span>
<span><span class="co">#&gt; 44.0097800 47.1655329 53.0303030</span></span></code></pre></div>
<p>We can also obtain markers for each cluster using the <code>Seurat</code> function <strong>FindAllMarkers</strong> and plot those genes in the eTraces.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html">FindAllMarkers</a></span><span class="op">(</span><span class="va">sc_seu</span>, </span>
<span>                          only.pos <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                          min.pct <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                          logfc.threshold <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">markers</span> <span class="op">&lt;-</span> <span class="va">markers</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">markers</span><span class="op">$</span><span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">0.001</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">markers</span><span class="op">$</span><span class="va">gene</span>, <span class="va">markers</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">markers</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">markers</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>        <span class="va">g</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">g</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">corticogenesis_sce</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/neuRoDev/man/plot_eTrace.html">plot_eTrace</a></span><span class="op">(</span>net <span class="op">=</span> <span class="va">corticogenesis_sce</span>, </span>
<span>                    genes <span class="op">=</span> <span class="va">g</span>, </span>
<span>                    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"markers of cluster"</span>,<span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: left">
<span style="display:block;" id="fig:ch4-fig10"></span>
<img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig10-1.png" alt="eTraces of markers of selected clusters." width="48%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig10-2.png" alt="eTraces of markers of selected clusters." width="48%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig10-3.png" alt="eTraces of markers of selected clusters." width="48%"><img src="libs/4.2-Mapping_scRNAseq_files/figure-html/ch4-fig10-4.png" alt="eTraces of markers of selected clusters." width="48%"><p class="caption">
Figure 5.10: eTraces of markers of selected clusters.
</p>
</div>
<p>Again, it is easy to distinguish between more neuronal clusters and more radial glia-like clusters, but also we can find some clusters that are more inhibitory neurons-like (e.g. clusters 22 and 11), and cluster 23 markers which are highly expressed in microglia too, pointing to a possible transcriptional signature stress-related.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="mapping-bulk.html"><span class="header-section-number">4</span> Mapping Bulk data</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#mapping-sc"><span class="header-section-number">5</span> Mapping Single-cell data</a></li>
<li><a class="nav-link" href="#quickstart-2"><span class="header-section-number">5.1</span> Quickstart</a></li>
<li>
<a class="nav-link" href="#loading-necessary-libraries-and-data-3"><span class="header-section-number">5.2</span> Loading necessary libraries and data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#loading-the-right-libraries-3"><span class="header-section-number">5.2.1</span> Loading the right libraries</a></li>
<li><a class="nav-link" href="#loading-the-networks-necessary-objects-3"><span class="header-section-number">5.2.2</span> Loading the networks necessary objects</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#mapping-a-single-cell-rnaseq-dataset"><span class="header-section-number">5.3</span> Mapping a single cell RNAseq dataset</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-preprocessing"><span class="header-section-number">5.3.1</span> Data preprocessing</a></li>
<li><a class="nav-link" href="#data-summary"><span class="header-section-number">5.3.2</span> Data summary</a></li>
<li><a class="nav-link" href="#mapping-on-the-reference-network"><span class="header-section-number">5.3.3</span> Mapping on the reference network</a></li>
<li><a class="nav-link" href="#knwoledge-transfer"><span class="header-section-number">5.3.4</span> Knwoledge transfer</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/davilavelderrainlab/neuRoDev/blob/main/book//blob/master/4.2-Mapping_scRNAseq.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/davilavelderrainlab/neuRoDev/blob/main/book//edit/master/4.2-Mapping_scRNAseq.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>neuRoDev</strong>" was written by Erik Bot &amp; Asia Zonca. It was last built on 2025-12-05.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
